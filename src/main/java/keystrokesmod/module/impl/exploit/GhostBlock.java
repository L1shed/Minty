package keystrokesmod.module.impl.exploit;

import keystrokesmod.event.SendPacketEvent;
import keystrokesmod.module.Module;
import keystrokesmod.module.setting.impl.ModeSetting;
import keystrokesmod.utility.PacketUtils;
import keystrokesmod.utility.Utils;
import net.minecraft.network.play.client.C07PacketPlayerDigging;
import net.minecraft.network.play.client.C08PacketPlayerBlockPlacement;
import net.minecraft.util.BlockPos;
import net.minecraft.util.EnumFacing;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;
import org.jetbrains.annotations.NotNull;

public class GhostBlock extends Module {
    private final ModeSetting mode;

    public GhostBlock() {
        super("GhostBlock", category.exploit);
        this.registerSetting(mode = new ModeSetting("Mode", new String[]{"Client", "Place", "Break"}, 0));
    }

    @Override
    public void onEnable() {
        Utils.sendMessage("Right click a block to create a ghost block");
    }

    @SubscribeEvent
    public void onSendPacket(@NotNull SendPacketEvent event) {
        if (event.getPacket() instanceof C08PacketPlayerBlockPlacement) {
            C08PacketPlayerBlockPlacement packet = (C08PacketPlayerBlockPlacement) event.getPacket();
            if (packet.getPosition() != BlockPos.ORIGIN) {
                switch ((int) mode.getInput()) {
                    case 0:
                        event.setCanceled(true);
                        break;
                    case 1:
                        break;
                    case 2:
                        PacketUtils.sendPacket(new C07PacketPlayerDigging(C07PacketPlayerDigging.Action.START_DESTROY_BLOCK, packet.getPosition(), EnumFacing.getFront(packet.getPlacedBlockDirection())));
                        break;
                }
                mc.theWorld.setBlockToAir(packet.getPosition());
            }
        }
    }
}
